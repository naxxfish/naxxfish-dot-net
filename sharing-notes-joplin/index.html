<!doctype html><html lang=en>
<head>
<title>ğŸ—’ Sharing notes between Joplin users :: naxxfish</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="As I mentioned in a previous post, I&amp;rsquo;ve decided to move to Joplin for my note taking needs. One of the last features I was missing was the ability for me to share a note with other people - as I do with Google Keep at the moment.
I&amp;rsquo;m not the only one missing this feature, there&amp;rsquo;s a thread on the forum requesting this that&amp;rsquo;s been open for a long time, and has a lot of views. So I decided to try and help develop it.
">
<meta name=keywords content="software engineer developer tech devops">
<meta name=robots content="noodp">
<link rel=canonical href=https://naxxfish.net/sharing-notes-joplin/>
<link rel=stylesheet href=https://naxxfish.net/assets/style.css>
<link rel=stylesheet href=https://naxxfish.net/assets/blue.css>
<link rel=apple-touch-icon href=https://naxxfish.net/img/apple-touch-icon-192x192.png>
<link rel="shortcut icon" href=https://naxxfish.net/cropped-siteicon.png>
<meta name=twitter:card content="summary">
<meta name=twitter:site content="naxxfish.net">
<meta name=twitter:creator content="naxxfish">
<meta property="og:locale" content="en">
<meta property="og:type" content="article">
<meta property="og:title" content="ğŸ—’ Sharing notes between Joplin users">
<meta property="og:description" content="As I mentioned in a previous post, I&amp;rsquo;ve decided to move to Joplin for my note taking needs. One of the last features I was missing was the ability for me to share a note with other people - as I do with Google Keep at the moment.
I&amp;rsquo;m not the only one missing this feature, there&amp;rsquo;s a thread on the forum requesting this that&amp;rsquo;s been open for a long time, and has a lot of views. So I decided to try and help develop it.
">
<meta property="og:url" content="https://naxxfish.net/sharing-notes-joplin/">
<meta property="og:site_name" content="naxxfish">
<meta property="og:image" content="https://naxxfish.net/cropped-siteicon.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<meta property="article:section" content="Personal">
<meta property="article:section" content="Technology">
<meta property="article:published_time" content="2019-11-17 18:00:45 +0000 UTC">
<meta name=google-site-verification content="P9Dp9e0NPbJWb6JGToW0HNica_0Y6aRaZJmX4Y1pg1o">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ğŸ—’ Sharing notes between Joplin users","datePublished":"2019-11-17T18:00:45Z","dateModified":"2019-11-17T18:00:45Z","author":{"@context":"https://schema.org/","@id":"https://naxxfish.net/about","@type":"Person","alternateName":"naxxfish","alumniOf":{"@type":"CollegeOrUniversity","name":"University of Kent","sameAs":["https://www.kent.ac.uk/","https://en.wikipedia.org/wiki/University_of_Kent"]},"birthPlace":{"@type":"Place","address":{"@type":"PostalAddress","addressCountry":"United Kingdom","addressLocality":"London"}},"callsign":"M7NXF","description":"Technologist","gender":"male","homeLocation":{"@type":"Place","address":{"@type":"PostalAddress","addressCountry":"United Kingdom","addressLocality":"London"}},"image":["https://naxxfish.net/images/naxxfish-portrait/1x1/naxxfish-portrait.jpg","https://naxxfish.net/images/naxxfish-portrait/16x9/naxxfish-portrait.jpg","https://naxxfish.net/images/naxxfish-portrait/4x3/naxxfish-portrait.jpg"],"jobTitle":"Product Manager","knowsAbout":["https://en.wikipedia.org/wiki/Software_engineering","https://en.wikipedia.org/wiki/Broadcast_engineering","https://en.wikipedia.org/wiki/Computer_engineering","https://en.wikipedia.org/wiki/Embedded_system","https://en.wikipedia.org/wiki/Serverless_computing","https://en.wikipedia.org/wiki/Radio_broadcasting","https://en.wikipedia.org/wiki/Audio_engineer"],"memberOf":[{"@type":"Organization","name":"Audio Engineering Society","url":"http://www.aes.org/"}],"name":"Chris Roberts","nationality":"British","sameAs":["https://www.github.com/naxxfish","https://instagram.com/naxxfish","https://naxxfish.photography"],"worksFor":{"@type":"Organization","name":"British Broadcasting Corporation","sameAs":"https://www.bbc.co.uk/"}},"image":"https://naxxfish.net/sharing-notes-joplin/","wordcount":1549,"timeRequired":"PT8M","mainEntityOfPage":{"@type":"WebPage"},"publisher":{"@type":"Organization","name":"Software Engineer","logo":{"@type":"ImageObject","url":"https://naxxfish.net/cropped-siteicon.png"}},"description":"As I mentioned in a previous post, I\u0026rsquo;ve decided to move to Joplin for my note taking needs. One of the last features I was missing was the ability for me to share a note with other people - as I do with Google Keep at the moment.\nI\u0026rsquo;m not the only one missing this feature, there\u0026rsquo;s a thread on the forum requesting this that\u0026rsquo;s been open for a long time, and has a lot of views. So I decided to try and help develop it.\n","keywords":["joplin"],"articleBody":"As I mentioned in a previous post, I\u0026rsquo;ve decided to move to Joplin for my note taking needs. One of the last features I was missing was the ability for me to share a note with other people - as I do with Google Keep at the moment.\nI\u0026rsquo;m not the only one missing this feature, there\u0026rsquo;s a thread on the forum requesting this that\u0026rsquo;s been open for a long time, and has a lot of views. So I decided to try and help develop it.\nğŸ’¬ The Requirement A good place to start is by defining exactly what you want. Fundementally, I think the user-story goes something along the lines of:\n As a user of Joplin, I need to share the contents of a note with another user of Joplin, so that I can collaborate with them.\n And as a concrete use case:\n I have written down our excellent recipe for chilli con carne. I want to share it with my partner, so that they can add the ingredients to the shopping list easily.\n Another useful thing to call out is what\u0026rsquo;s not in scope, that may come to mind. In this case, the following things are not in scope:\n Two-way sync Realtime collaboration  ğŸ”¨ The Brute-force Solution The least complex way of solving this is simple: email the note to each other. It works, but has some drawbacks\u0026hellip;\n May be unencrypted It requires awkward copy pasting Some email clients may mangle the Markdown syntax with rich-text formatting Updating the document requires you to send it again.  Another \u0026lsquo;simple\u0026rsquo; solution might be to use a pastebin. However\u0026hellip;\n They\u0026rsquo;re often not encrypted They not always be accessible It requires yet more copy pasting You are forced to trust the administrators with your data  There must be a better way.\nâš™ï¸ The Technical Context Joplin\u0026rsquo;s notes are stored in a local SQLite database in each device. In order to sync this database with other devices, it exports this data (and settings) to files, which are uploaded to a central location (for example a Nextcloud instance or Dropbox). On another device, these files are downloaded and then imported into it\u0026rsquo;s own local SQLite database.\nThose sync files (residing on the central storage) can be optionally encrypted by enabling End-to-End Encryption, so that they are encrypted in transit (between the device and central storage) and at rest (when on central storage). The data is generally not encrypted in the local SQLite database. When synchonisation begins, the contents of the database is exported to the sync files and encrypted at that point.\nTherefore, sending the sync files to another user is no good - unless they have the same Master Key as you, and want to share all of your settings too. So, how does one share the notes?\nğŸ” End-to-End-to-End Encryption We would like the note to be encrypted on it\u0026rsquo;s journey from the sender to the recipient, and we need to be able to send the recipient a key we don\u0026rsquo;t mind them having (so, probably not our Master Key).\n Encrypt Decrypt (sharing key) â”Œâ”€â”€â”€â”€â”€â”€â”€â” (sharing key) â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ??? â”‚â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Sender â”‚ â”‚ Reciever â”‚ â”‚ Joplin â”‚ â”‚ Joplin â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Decrypt â–² â”‚ Encrypt (master key â”‚ â”‚ (master key A) â”‚ â”‚ B) â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚ Sync â”‚ â”‚ Sync â”‚ â”‚Backendâ”‚ â”‚Backendâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ At the client, we\u0026rsquo;ve already decrypted the note (in order to view it). So we could encrypt it with a new key, then send the note to the recipient (with the new \u0026lsquo;sharing\u0026rsquo; key), who can decrypt it, and place it in their own notebook.\nğŸšš Sending the (encrypted) note to the recipient Now we\u0026rsquo;ve encrypted it, we need to convey the note to the recipient in a way that\u0026rsquo;s straightforward and honors the decentralised ethos of Joplin.\nTruly decentralised networks are, on the whole, non-existant on the public Internet. Even Peer-to-Peer protocols need a prior knowledge of a central point to discover the rest of their peers (for example a BitTorrent Tracker or a node in the DHT, or even DNS entries).\nSo there needs to be some location, accessible by both sender and recipient, that can store-and-forward an encrypted message. An easily deployable web-service might do the trick: thus, why I started joplin-share-server. It\u0026rsquo;s got an endpoint to POST encrypted notes to, and one to GET them from. It doesn\u0026rsquo;t store the encryption keys at all.\nThe client side implementation would look something like this:\n Encrypt the note with a key (for example, abc123). Make a request to POST /note to the web service with a JSON object containing the encrypted note, and the server issues it with a Note ID (say, def456). Construct a URL using the Note ID, and append the key to the end using the anchor section (e.g. http://share.joplinapp.org/note/def456#abc123) Send that URL to the recipient (via email, IM, etc.) The recipient requests GET /note/def456 to obtain the encrypted note. The recipient then uses the key in the anchor section of the URL to decrypt the note. The decrypted note is then stored in the recipient\u0026rsquo;s notebook.  In order for these URLs to open opened by Joplin instead of your browser, you\u0026rsquo;d need to register a protocol handler on the device. Joplin for desktop OSes is made using Electron, and there is a way of registering custom protocols with electron. The mobile apps are made with React-Native, and there\u0026rsquo;s a way of registering protocol schemes there as well.\nğŸš Configuration When you send a note, you would need to know the location of a share server to send the encrypted note to. Recieving notes, you don\u0026rsquo;t need any additional config as the location is the URL.\nSo for senders, there would need to be a new configuration parameter called \u0026lsquo;Share Server\u0026rsquo; to enter the location of a working share server.\nğŸ–Š Updates What if the sender makes a change to the note - how do we replicate those changes to the recipient?\nIn the simple one-way sync case (remember, two-way sync is out of scope for the moment), the sender could POST new content to the same endpoint using the same Note ID, incrementing the version number. The recipient could then poll the share server when they synchronise, and update their note if the version increments.\nOr, they could make a request to a Server Sent Events endpoint on the share server and wait for a notification that an update has been made to a note they are interested in.\nTwo way sync is significantly more complex, as you need to handle situations one party makes conflicting edits to the other. The Conclave project documentation demonstrates the complexity of this very well.\nğŸ— The Server Architecture Aside from making a HTTP REST API server, there are a few architectural considerations that are required.\nğŸ“¦ Deployment joplin-share-server is a Node.JS app, which uses express to serve a HTTP API. It has, for the moment, two methods - POST and GET. One lets you post a note, the other lets you get one. You can run it using the joplin-share-server Docker image ğŸ³, so it should be easy for people to host on their own servers, but you can deploy it to services like Heroku or Firebase Cloud Run just as easily.\nğŸ—„ Database Backend It currently has a PostgreSQL backend, which is probably perfectly fine for the vast majority of users (NoSQL doesn\u0026rsquo;t solve any problems that this app is likely to have\u0026hellip;).\nğŸ” Security Given a service which will write stuff to a database for any anonymous user, this is kind of important. Input is structure and format is validated before being commmitted to the database. Fields that are expected to be base64 encoded are verified that they are. The encrypted note data, however, is opaque to the server, so there\u0026rsquo;s not a lot we can do with that.\nHow do you prevent other people from updating your notes, if they get access to the note? One way is to issue tokens for each note, which you need to use in order to access it. The sender is provided with these tokens when they create the note, but they are never transmitted again after that point. The sender is responsible for keeping those tokens with the note they are sharing, so that they retain the ability to make updates to the note later. If they loose them, they\u0026rsquo;ll have to share the note again.\nThe main risk is a DoS attack where a malicious user simply creates thousands of (valid) notes, filling up the database. You can limit the risk of this by implementing rate limiting, and potentially block clients which generate an excessive number of requests temporarily - for example by using express-blacklist and express-defend.\nAnd, of course, you will need to somehow ensure that notes eventually expire and are deleted when they are no longer needed. That could be as simple as resetting a Time to Live field every time the note is accessed, so that notes that are still being used are retained, whilst ones which are not are not.\nâ” Conclusion Quite a lot of stuff to do and consider, but worth doing to make a differentiating feature in an already awesome app!\n"}</script>
</head>
<body class=blue>
<div class="container center headings--one-size">
<header class=header>
<div class=header__inner>
<div class=header__logo>
<a href=/>
<div class=logo>
naxxfish
</div>
</a>
</div>
<div class=menu-trigger>menu</div>
</div>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/about>About</a></li>
<li><a href=https://www.github.com/naxxfish/>Github</a></li>
<li><a href=https://naxxfish.photography>My Photography</a></li>
<li><a href=/wish-list>Wish List</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/about>About</a></li>
<li><a href=https://www.github.com/naxxfish/>Github</a></li>
<li><a href=https://naxxfish.photography>My Photography</a></li>
<li><a href=/wish-list>Wish List</a></li>
</ul>
</nav>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>
<a href=https://naxxfish.net/sharing-notes-joplin/>ğŸ—’ Sharing notes between Joplin users</a></h1>
<div class=post-meta>
<span class=post-date>
2019-11-17
</span>
<span class=post-author>::
naxxfish
</span>
</div>
<span class=post-tags>
#<a href=https://naxxfish.net/tags/joplin/>joplin</a>&nbsp;
</span>
<meta itemprop=dateModified content="2019-11-17T18:00:45Z">
<meta itemprop=author content="naxxfish">
<div class=post-content>
<p>As I mentioned in a <a href=/note-taking-apps-for-engineers-2019>previous post</a>, I&rsquo;ve decided to move to <a href=https://www.joplinapp.org/>Joplin</a> for my note taking needs. One of the last features I was missing was the ability for me to share a note with other people - as I do with Google Keep at the moment.</p>
<p>I&rsquo;m not the only one missing this feature, <a href=https://discourse.joplinapp.org/t/sharing-notes-or-notebooks/67/38>there&rsquo;s a thread on the forum</a> requesting this that&rsquo;s been open for a long time, and has a <em>lot</em> of views. So I decided to try and help develop it.</p>
<h1 id=-the-requirement>ğŸ’¬ The Requirement</h1>
<p>A good place to start is by defining exactly what you want. Fundementally, I think the user-story goes something along the lines of:</p>
<blockquote>
<p>As a user of Joplin, I need to share the contents of a note with another user of Joplin, so that I can collaborate with them.</p>
</blockquote>
<p>And as a concrete use case:</p>
<blockquote>
<p>I have written down our excellent recipe for chilli con carne. I want to share it with my partner, so that they can add the ingredients to the shopping list easily.</p>
</blockquote>
<p>Another useful thing to call out is what&rsquo;s <strong>not</strong> in scope, that may come to mind. In this case, the following things are <strong>not</strong> in scope:</p>
<ul>
<li>Two-way sync</li>
<li>Realtime collaboration</li>
</ul>
<h1 id=-the-brute-force-solution>ğŸ”¨ The Brute-force Solution</h1>
<p>The least complex way of solving this is simple: email the note to each other. It works, but has some drawbacks&mldr;</p>
<ul>
<li>May be <strong>unencrypted</strong></li>
<li>It requires awkward <strong>copy pasting</strong></li>
<li>Some email clients may <strong>mangle the Markdown syntax</strong> with rich-text formatting</li>
<li><strong>Updating</strong> the document requires you to send it again.</li>
</ul>
<p>Another &lsquo;simple&rsquo; solution might be to <a href=https://discourse.joplinapp.org/t/sharing-notes-or-notebooks/67/27>use a pastebin</a>. However&mldr;</p>
<ul>
<li>They&rsquo;re often <strong>not encrypted</strong></li>
<li>They not always be <strong>accessible</strong></li>
<li>It requires yet more <strong>copy pasting</strong></li>
<li>You are forced to <strong>trust</strong> the administrators with your data</li>
</ul>
<p>There must be a better way.</p>
<h1 id=-the-technical-context>âš™ï¸ The Technical Context</h1>
<p>Joplin&rsquo;s notes are stored in a local <a href=https://www.sqlite.org/index.html>SQLite</a> database in each device. In order to sync this database with other devices, it exports this data (and settings) to files, which are uploaded to a central location (for example a <a href=https://nextcloud.com/>Nextcloud</a> instance or <a href=https://www.dropbox.com/>Dropbox</a>). On another device, these files are downloaded and then imported into it&rsquo;s own local SQLite database.</p>
<p>Those sync files (residing on the central storage) can be optionally encrypted by enabling <a href=https://joplinapp.org/e2ee/>End-to-End Encryption</a>, so that they are encrypted in transit (between the device and central storage) and at rest (when on central storage). The data is generally <em>not</em> encrypted in the local SQLite database. When synchonisation begins, the contents of the database is exported to the sync files and encrypted at that point.</p>
<p>Therefore, sending the sync files to another user is no good - unless they have the same Master Key as you, and want to share all of your settings too. So, how does one share the notes?</p>
<h1 id=-end-to-end-to-end-encryption>ğŸ” End-to-End-to-End Encryption</h1>
<p>We would like the note to be encrypted on it&rsquo;s journey from the sender to the recipient, and we need to be able to send the recipient a key we don&rsquo;t mind them having (so, probably not our Master Key).</p>
<pre tabindex=0><code>                                                       
           Encrypt                   Decrypt           
        (sharing key)   â”Œâ”€â”€â”€â”€â”€â”€â”€â” (sharing key)        
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  ???  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”             
              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚             
              â”‚                          â–¼             
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       
       â”‚   Sender   â”‚             â”‚  Reciever  â”‚       
       â”‚   Joplin   â”‚             â”‚   Joplin   â”‚       
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       
  Decrypt     â–²                          â”‚   Encrypt   
(master key   â”‚                          â”‚ (master key 
     A)       â”‚                          â”‚      B)     
              â”‚                          â–¼             
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”         
          â”‚ Sync  â”‚                  â”‚ Sync  â”‚         
          â”‚Backendâ”‚                  â”‚Backendâ”‚         
          â””â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”˜         
</code></pre><p>At the client, we&rsquo;ve already decrypted the note (in order to view it). So we could encrypt it with a new key, then send the note to the recipient (with the new &lsquo;sharing&rsquo; key), who can decrypt it, and place it in their own notebook.</p>
<h1 id=-sending-the-encrypted-note-to-the-recipient>ğŸšš Sending the (encrypted) note to the recipient</h1>
<p>Now we&rsquo;ve encrypted it, we need to convey the note to the recipient in a way that&rsquo;s straightforward and honors the decentralised ethos of Joplin.</p>
<p>Truly decentralised networks are, on the whole, non-existant on the public Internet. Even Peer-to-Peer protocols need a prior knowledge of a central point to discover the rest of their peers (for example a <a href=https://en.wikipedia.org/wiki/BitTorrent_tracker>BitTorrent Tracker</a> or a node in the <a href=https://en.wikipedia.org/wiki/Mainline_DHT>DHT</a>, or even <a href=https://en.wikipedia.org/wiki/Domain_Name_System>DNS</a> entries).</p>
<p>So there needs to be some location, accessible by both sender and recipient, that can store-and-forward an encrypted message. An easily deployable web-service might do the trick: thus, why I started <a href=https://github.com/naxxfish/joplin-share-server>joplin-share-server</a>. It&rsquo;s got an endpoint to <code>POST</code> encrypted notes to, and one to <code>GET</code> them from. It doesn&rsquo;t store the encryption keys at all.</p>
<p>The client side implementation would look something like this:</p>
<ol>
<li>Encrypt the note with a key (for example, <code>abc123</code>).</li>
<li>Make a request to <code>POST /note</code> to the web service with a JSON object containing the encrypted note, and the server issues it with a Note ID (say, <code>def456</code>).</li>
<li>Construct a URL using the Note ID, and append the key to the end using the anchor section (e.g. <code>http://share.joplinapp.org/note/def456#abc123</code>)</li>
<li>Send that URL to the recipient (via email, IM, etc.)</li>
<li>The recipient requests <code>GET /note/def456</code> to obtain the encrypted note.</li>
<li>The recipient then uses the key in the anchor section of the URL to decrypt the note.</li>
<li>The decrypted note is then stored in the recipient&rsquo;s notebook.</li>
</ol>
<p>In order for these URLs to open opened by Joplin instead of your browser, you&rsquo;d need to register a protocol handler on the device. Joplin for desktop OSes is made using <a href=https://electronjs.org/>Electron</a>, and there is <a href=https://glebbahmutov.com/blog/electron-app-with-custom-protocol/>a way of registering custom protocols with electron</a>. The mobile apps are made with <a href=https://facebook.github.io/react-native/>React-Native</a>, and <a href=https://www.npmjs.com/package/react-native-deep-link>there&rsquo;s a way of registering protocol schemes</a> there as well.</p>
<h1 id=-configuration>ğŸš Configuration</h1>
<p>When you send a note, you would need to know the location of a share server to send the encrypted note to. Recieving notes, you don&rsquo;t need any additional config as the location is the URL.</p>
<p>So for senders, there would need to be a new configuration parameter called &lsquo;Share Server&rsquo; to enter the location of a working share server.</p>
<h1 id=-updates>ğŸ–Š Updates</h1>
<p>What if the sender makes a change to the note - how do we replicate those changes to the recipient?</p>
<p>In the simple one-way sync case (remember, two-way sync is out of scope for the moment), the sender could <code>POST</code> new content to the same endpoint using the same Note ID, incrementing the version number. The recipient could then poll the share server when they synchronise, and update their note if the version increments.</p>
<p>Or, they could make a request to a <a href=https://jasonbutz.info/2018/08/server-sent-events-with-node/>Server Sent Events</a> endpoint on the share server and wait for a notification that an update has been made to a note they are interested in.</p>
<p>Two way sync is significantly more complex, as you need to handle situations one party makes conflicting edits to the other. The <a href=https://conclave-team.github.io/conclave-site/>Conclave project</a> documentation demonstrates the complexity of this very well.</p>
<h1 id=-the-server-architecture>ğŸ— The Server Architecture</h1>
<p>Aside from making a HTTP REST API server, there are a few architectural considerations that are required.</p>
<h2 id=-deployment>ğŸ“¦ Deployment</h2>
<p><a href=https://github.com/naxxfish/joplin-share-server>joplin-share-server</a> is a <a href=https://nodejs.org/en/>Node.JS</a> app, which uses express to serve a HTTP API. It has, for the moment, two methods - <code>POST</code> and <code>GET</code>. One lets you post a note, the other lets you get one. You can run it using the <a href=https://hub.docker.com/repository/docker/naxxfish/joplin-share-server>joplin-share-server Docker image ğŸ³</a>, so it should be easy for people to host on their own servers, but you can deploy it to services like <a href=https://www.heroku.com/>Heroku</a> or <a href=https://firebase.google.com/docs/hosting/cloud-run>Firebase Cloud Run</a> just as easily.</p>
<h2 id=-database-backend>ğŸ—„ Database Backend</h2>
<p>It currently has a <a href=https://www.postgresql.org/>PostgreSQL</a> backend, which is probably perfectly fine for the vast majority of users (NoSQL doesn&rsquo;t solve any problems that this app is likely to have&mldr;).</p>
<h2 id=-security>ğŸ” Security</h2>
<p>Given a service which will write stuff to a database for any anonymous user, this is kind of important. Input is structure and format is validated before being commmitted to the database. Fields that are expected to be base64 encoded are verified that they are. The encrypted note data, however, is opaque to the server, so there&rsquo;s not a lot we can do with that.</p>
<p>How do you prevent other people from updating your notes, if they get access to the note? One way is to issue tokens for each note, which you need to use in order to access it. The sender is provided with these tokens when they create the note, but they are never transmitted again after that point. The sender is responsible for keeping those tokens with the note they are sharing, so that they retain the ability to make updates to the note later. If they loose them, they&rsquo;ll have to share the note again.</p>
<p>The main risk is a <a href=https://en.wikipedia.org/wiki/Denial-of-service_attack>DoS</a> attack where a malicious user simply creates thousands of (valid) notes, filling up the database. You can limit the risk of this by implementing <a href=https://www.npmjs.com/package/express-rate-limit>rate limiting</a>, and potentially block clients which generate an excessive number of requests temporarily - for example by using <a href=https://www.npmjs.com/package/express-blacklist>express-blacklist</a> and <a href=https://www.npmjs.com/package/express-defend>express-defend</a>.</p>
<p>And, of course, you will need to somehow ensure that notes eventually expire and are deleted when they are no longer needed. That could be as simple as resetting a Time to Live field every time the note is accessed, so that notes that are still being used are retained, whilst ones which are not are not.</p>
<h1 id=-conclusion>â” Conclusion</h1>
<p>Quite a lot of stuff to do and consider, but worth doing to make a differentiating feature in an already awesome app!</p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://naxxfish.net/2019/12/08/my-photography-workflow/>
<span class=button__icon>â†</span>
<span class=button__text>My Photography Workflow</span>
</a>
</span>
<span class="button next">
<a href=https://naxxfish.net/note-taking-apps-for-engineers-2019/>
<span class=button__text>Note-taking apps for Engineers in 2019</span>
<span class=button__icon>â†’</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user">
<span>Chris Roberts</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span>
</div>
</div>
</footer>
<script src=https://naxxfish.net/assets/main.js></script>
<script src=https://naxxfish.net/assets/prism.js></script>
<script type=text/javascript src=https://ko-fi.com/widgets/widget_2.js></script><script type=text/javascript>kofiwidget2.init('Buy me a coffee','#23B0FF','R6R418B52'),kofiwidget2.draw()</script>
<a rel=me href=https://mastodon.technology/@naxxfish>Mastodon</a>
</div>
</body>
</html>